<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.min.js"></script>
<style>
.grid line {
  stroke: lightgrey;
  stroke-opacity: 0.7;
  shape-rendering: crispEdges;
}
svg
{
	width:90%;
	height:100%;
	
}
</style>
</head>
<body>


  
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-4">
	<div>for Year<hr></div>
      <div id="svgdivForYear">
	  
	  </div>
    </div>
    <div class="col-sm-4">
	<div>For Month<hr></div>
      <div id="svgdivForMonth" >
	  </div>  

	  </div>
    
      <div class="col-sm-4">
        <div>For Days<hr></div>
          <div id="svgdivForDay" >
          </div>  
    
          </div>
  </div>
</div>
<script>

var jdata1=[
{
    type:'TA',
    radius:3,
    startDate:"Jan",
    count:1
},
{
    type:'CRC',
    radius:5,
    startDate:"Feb",
    count:2
},
{
    type:'CRC',
    radius:7,
    startDate:"Mar",
    count:2
},
{
    type:'CRC',
    radius:7,
    startDate:"Apr",
    count:2
},
{
    type:'CRC',
    radius:7,
    startDate:"May",
    count:2
},
{
    type:'CRC',
    radius:7,
    startDate:"Jun",
    count:2
},
{
    type:'CRC',
    radius:7,
    startDate:"Jul",
    count:2
}


];



var jdata3=[
{
    type:'TA',
    radius:3,
    startDate:"1",
    count:1
},
{
    type:'CRC',
    radius:5,
    startDate:"2",
    count:2
},
{
    type:'CRC',
    radius:6,
    startDate:"2",
    count:2
},
{
    type:'CRC',
    radius:3,
    startDate:"4",
    count:2
},
{
    type:'CRC',
    radius:11,
    startDate:"5",
    count:2
},
{
    type:'CRC',
    radius:3,
    startDate:"7",
    count:2
},
{
    type:'CRC',
    radius:2,
    startDate:"7",
    count:2
}


];

var jdata=[
// {
//     type:'TA',
//     radius:3,
//     startDate:"2016",
//     count:1
// },
// {
//     type:'CRC',
//     radius:5,
//     startDate:"2017",
//     count:2
// },
// {
//     type:'CRC',
//     radius:7,
//     startDate:"2017",
//     count:2
// },
{
    type:'WAR',
    radius:3,
    startDate:"2018",
    count:1
}
,
{
    type:'TA',
    radius:11,
    startDate:"2018",
    count:7
 },
// {
//     type:'TA',
//     radius:11,
//     startDate:"2019",
//     count:7
// }

]
this.createSimulationChartforMonth("svgdivForYear",jdata);
this.createSimulationChartforMonth("svgdivForMonth",jdata1);
this.createSimulationChartforMonth("svgdivForDay",jdata3);


  function createSimulationChartforMonth(id,jdata){
    var margin = {top: 20, right: 20, bottom: 70, left: 40},
width = 800 - margin.left - margin.right,
height = 400 - margin.top - margin.bottom;

var xScale = d3.scaleBand()
  .domain(jdata.map(function(d){ return d.startDate}))
  .range([0, width]);

var xAxis = d3.axisBottom(xScale);

var tooltip = d3.select("#"+id)
.append("div")
  .style("opacity", 0)
  .attr("class", "tooltip")
  .style("background-color", "black")
  .style("border-radius", "5px")
  .style("padding", "10px")
  .style("color", "white")

// -2- Create 3 functions to show / upstartDate (when mouse move but stay on same circle) / hide the tooltip
var showTooltip = function(d) {
tooltip
  .transition()
  .duration(200)
tooltip
  .style("opacity", 1)
  .html("Case Type: " + d.type + "<br\/>" + "Case Count: " + d.count)
  .style("left", (d3.mouse(this)[0]+30) + "px")
  .style("top", (d3.mouse(this)[1]+30) + "px")
}
var moveTooltip = function(d) {
tooltip
  .style("left", (d3.mouse(this)[0]+30) + "px")
  .style("top", (d3.mouse(this)[1]+30) + "px")
}
var hideTooltip = function(d) {
tooltip
  .transition()
  .duration(200)
  .style("opacity", 0)
}
    
    
  
  


d3.select("#"+id).select("svg").remove();
    var svg = d3.select("#"+id)
       .append("svg").style("background-color","white")
       .attr("width",width).attr("height",height).style("width","100%")//.style("height","100%")
     .attr("transform", `translate(${0}, ${0})`).attr( "viewBox",`${0} ${0} ${width} ${height} `)
   
.attr("preserveAspectRatio","xMinYMin meet");



svg.append("g")
       .attr("class", "x axis")
     
       .attr("transform", `translate(20,${height-60})`)
       .call(xAxis);




       var data = d3.range(jdata.length).map(function(d, i){
      return {
        type:jdata[i].type,
      group: jdata[i].startDate,
      radius:jdata[i].radius,
      count:jdata[i].count,
      id: i
     
      }
    });

    const result = [];
const map = new Map();
for (const item of data) {
    if(!map.has(item.group)){
        map.set(item.group, true);    // set any value to Map
        result.push({
            group: item.group,
            count: item.count
        });
    }
}
    console.log("distinct Year : ",result)
  console.log("data for month : ",data)
  
    var forceX = d3.forceX((d) => xScale(d.group)).strength(0.00001);
   
    var forceY = d3.forceY((d) => height/3).strength(0.006);
  
     
    
    var node = svg.append("g")
                .attr("class", "nodes")
                .selectAll("circle")
                .data(data)
                .enter().append("circle")
                .attr("cx", function(d) { return xScale(d.group) ; })       
            
                .attr("r", (d)=>d.radius)
                .style("fill", 'navy')
                .on("mouseover", showTooltip )
.on("mousemove",showTooltip )
.on("mouseleave",showTooltip );
    
    var force = d3.forceSimulation(data)
        .velocityDecay(0.65)
        .force('x', forceX)
        .force('y', forceY)
        .force("collide", d3.forceCollide(8));
        
        force.nodes(data)
        .on('tick', function() {
             node
                .attr('transform', (d) => {

                    if(result.length==1 || result.length==2){
                        return 'translate(' + (d.x+width/2)+ ',' + (d.y+150) + ')';
                    }else
                    return 'translate(' + (d.x+100)+ ',' + (d.y+150) + ')';
                });
            });
            
  
  }
  
</script>
</body>
</html>